<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1" />
    <title>TODO</title>
</head>

<body>
    <!-- Load the lib -->
    <script src="../../dist/hyper-ui.umd.js"></script>
    <!-- Create the app -->
    <script type="text/javascript">
        // Define the app
        const TODO = HUI.define('TODO', {
            // Define the state
            state: ['items'],
            // Define the initializer
            init: function (props, store) {
                // Initialize the item list
                store.set('items', []);
            },
            // Define the renderer
            render: function (props, store) {
                return [
                    // Render a form
                    HUI('form', {
                        // Handle the submit event
                        onsubmit: function (e) {
                            e.preventDefault();
                            // Get the input element and its value
                            var input = store.get('input'),
                                content = input.value;
                            // Validate the input data
                            if (content) {
                                // Add this item
                                store.push('items', content);
                                /** 
                                 * @TODO Improve patching and fix this
                                 * 
                                 * // Clear the input
                                 * input.value = '';
                                 * 
                                 */
                                // Fix focus
                                HUI.defer(function () {
                                    store.get('input').focus();
                                });
                            } else {
                                // Hint the user to input something
                                input.focus();
                            }
                        }
                    }, [
                        // content input
                        HUI('input', {
                            ref: store.setter('input'),
                            placeholder: 'content'
                        }),
                        // submit button
                        HUI('input', {
                            attr: {
                                type: 'submit',
                                value: 'Add'
                            }
                        })
                    ]),
                    // Render an unordered list
                    HUI('ul', {}, store.get('items').map(function (item, i) {
                        // list item
                        return HUI('li', null, [
                            // content
                            HUI('span', {
                                style: 'margin-right: 1em;'
                            }, item),
                            // deleting link
                            HUI('a', {
                                href: 'javascript:;',
                                // Handle the click event
                                onclick: function () {
                                    // Delete the item
                                    store.splice('items', i, 1);
                                }
                            }, 'Del')
                        ]);
                    }))
                ];
            }
        });
        // Render
        HUI.render([
            // Render a heading
            HUI('h1', null, 'TODO'),
            // Render the app
            HUI(TODO)
        ]);
    </script>
</body>

</html>